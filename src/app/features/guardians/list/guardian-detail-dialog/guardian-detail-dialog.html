<p-dialog [(visible)]="visible"
          [modal]="true"
          [draggable]="false"
          [style]="{ width:'720px', maxWidth: '95vw' }"
          header="Λεπτομέρειες Κηδεμόνα"
          (onHide)="hide()">

  @if (guardian) {

    <!-- Header -->
    <div class="view-header">
      <div class="avatar">{{ initials() }}</div>
      <div class="flex-1">
        <div class="view-title">{{ guardian.name }}</div>
      </div>
      <p-tag
        [value]="guardian.students.length + ' μαθητ' + (guardian.students.length === 1 ? 'ής' : 'ές')"
        severity="info"
        [style]="{ fontSize: '0.9rem', padding: '0.3rem 0.75rem' }">
      </p-tag>
    </div>

    <!-- Info cards -->
    <div class="info-cards">

      <!-- Email -->
      <div class="info-card">
        <div class="info-card-icon">
          <i class="pi pi-envelope"></i>
        </div>
        <div class="info-card-content">
          <div class="info-card-label">Email</div>
          <div class="info-card-value">
            @if (guardian.email) {
              <a [href]="'mailto:' + guardian.email">{{ guardian.email }}</a>
            } @else {
              —
            }
          </div>
        </div>
      </div>

      <!-- Phone -->
      <div class="info-card">
        <div class="info-card-icon">
          <i class="pi pi-phone"></i>
        </div>
        <div class="info-card-content">
          <div class="info-card-label">Τηλέφωνο</div>
          <div class="info-card-value">
            @if (guardian.phone) {
              <a [href]="'tel:' + guardian.phone">{{ guardian.phone }}</a>
            } @else {
              —
            }
          </div>
        </div>
      </div>

      <!-- Preferred contact -->
      <div class="info-card">
        <div class="info-card-icon">
          <i class="pi pi-comment"></i>
        </div>
        <div class="info-card-content">
          <div class="info-card-label">Προτιμώμενη επικοινωνία</div>
          <div class="info-card-value">{{ preferredContactLabel() }}</div>
        </div>
      </div>

      <!-- Newsletter -->
      <div class="info-card">
        <div class="info-card-icon">
          <i class="pi pi-megaphone"></i>
        </div>
        <div class="info-card-content">
          <div class="info-card-label">Newsletter</div>
          <div class="info-card-value">{{ guardian.newsletter_consent ? 'Ναι' : 'Όχι' }}</div>
        </div>
      </div>
    </div>

    <!-- Address -->
    <div class="address-row">
      <i class="pi pi-map-marker"></i>
      @if (guardian.address?.street || guardian.address?.city || guardian.address?.zip) {
        <span>
          {{ guardian.address?.street || '' }}{{ guardian.address?.city ? ', ' + guardian.address?.city : '' }}{{ guardian.address?.zip ? ' ' + guardian.address?.zip : '' }}
        </span>
      } @else {
        <span>—</span>
      }
    </div>

    <!-- Notes -->
    <div class="section">
      <div class="section-title">Σημειώσεις</div>
      <div class="prewrap">{{ guardian.notes || '—' }}</div>
    </div>

    <!-- Students -->
    <div class="section">
      <div class="section-title">Μαθητές</div>

      @if (guardian.students.length === 0) {
        <div class="text-center text-600 p-3 surface-50 border-round">
          Δεν υπάρχουν μαθητές.
        </div>
      } @else {
        <div class="flex flex-column gap-2">
          @for (s of guardian.students; track s.id) {
            <div class="student-card clickable" (click)="openStudent(s.id)">
              <div class="student-card-name">
                <i class="pi pi-user"></i>
                {{ s.name }}
              </div>
              <div class="student-card-details">
                @if (s.email) {
                  <div class="student-card-row">
                    <i class="pi pi-envelope"></i>
                    <a [href]="'mailto:' + s.email">{{ s.email }}</a>
                  </div>
                }
                @if (s.phone) {
                  <div class="student-card-row">
                    <i class="pi pi-phone"></i>
                    <a [href]="'tel:' + s.phone">{{ s.phone }}</a>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      }
    </div>
  }
</p-dialog>

<app-student-detail-dialog
  [visible]="studentDialogVisible()"
  [student]="selectedStudent()"
  (visibleChange)="studentDialogVisible.set($event)"
  (close)="selectedStudent.set(null)">
</app-student-detail-dialog>
