<p-card>
    <div class="text-lg font-semibold mb-3">Νέα εγγραφή (Κηδεμόνας + Μαθητές)</div>

    <!-- Guardian -->
    <div class="surface-50 p-3 border-round mb-3">
        <div class="text-md font-semibold mb-2">Στοιχεία κηδεμόνα</div>

        <div class="grid">
            <div class="col-12 md:col-3">
                <label>Όνομα</label>
                <input 
                    pInputText
                    [formControl]="guardian.controls.first_name"
                    class="w-full"
                    placeholder="Προσθήκη ονόματος κηδεμόνα"
                />
            </div>

            <div class="col-12 md:col-3">
                <label>Επώνυμο</label>
                <input 
                    pInputText
                    [formControl]="guardian.controls.last_name"
                    class="w-full"
                    placeholder="Προσθήκη επωνύμου κηδεμόνα"
                />
            </div>

            <div class="col-12 md:col-3">
                <label>Email</label>
                <input
                    pInputText
                    type="email"
                    [formControl]="guardian.controls.email"
                    class="w-full"
                    placeholder="Προσθήκη ηλεκτρονικής διεύθυνσης κηδεμόνα"
                />
            </div>

            <div class="col-12 md:col-3">
                <label>Τηλέφωνο</label>
                <input 
                    pInputText
                    [formControl]="guardian.controls.phone"
                    class="w-full"
                    placeholder="Προσθήκη τηλεφώνου επικοινωνίας"    
                />
            </div>

            <div class="col-12 md:col-4">
                <label>Οδός</label>
                <input 
                    pInputText
                    [formControl]="guardian.controls.address.controls.street"
                    class="w-full"
                    placeholder="Προσθήκη διεύθυνση οικίας"
                />
            </div>

            <div class="col-12 md:col-4">
                <label>Πόλη</label>
                <input 
                    pInputText
                    [formControl]="guardian.controls.address.controls.city"
                    class="w-full"
                    placeholder="Προσθήκη πόλη διαμονής"
                />
            </div>

            <div class="col-12 md:col-4">
                <label>Τ.Κ.</label>
                <input
                    pInputText
                    [formControl]="guardian.controls.address.controls.zip"
                    class="w-full"
                    placeholder="Ταχυδρομικός Κώδικας"    
                />
            </div>

            <div class="col-12 md:col-4">
                <label>Προτίμηση επικοινωνίας</label>
                <p-select 
                    [options]="contactPrefs"
                    optionLabel="label"
                    optionValue="value"
                    [formControl]="guardian.controls.preferred_contact"
                    class="w-full">
                </p-select>
            </div>

            <div class="col-12 mt-2">
                <p-checkbox
                    inputId="newsletter"
                    [binary]="true"
                    [formControl]="guardian.controls.newsletter_consent">
                </p-checkbox>
                <label for="newsletter" class="ml-2">
                    Επιθυμώ να λαμβάνω ενημερωτικά νέα, εκδηλώσεις και προσφορές μέσω email ή SMS.
                </label>
            </div>

            <div class="col-12 md:col-8">
                <label>Σημειώσεις</label>
                <textarea
                    pInputTextarea
                    [autoResize]="true"
                    rows="3"
                    [formControl]="guardian.controls.notes"
                    class="w-full"
                    placeholder="Παρατηρήσεις">
                </textarea>
            </div>

            <div class="col-12">
                <button 
                    pButton 
                    class="p-button-text"
                    icon="pi pi-plus"
                    label="Προσθήκη μαθητή από στοιχεία κηδεμόνα"
                    (click)="addStudent(true)">
                </button>
            </div>
        </div>
    </div>

  <!-- Students -->
    <div class="text-md font-semibold mb-2">Μαθητές</div>

    <div class="flex justify-content-between align-items-center mb-2">
        <span class="text-600">Συμπλήρωσε έναν ή περισσότερους μαθητές</span>
        <button 
            pButton
            icon="pi pi-plus"
            label="Προσθήκη μαθητή"
            (click)="addStudent()">
        </button>
    </div>

    <div class="mb-3" *ngFor="let s of studentsFA.controls; let i = index">
        <div class="surface-card border-1 border-round p-3 mb-2">
            <div class="flex align-items-center justify-content-between mb-2">
                <div class="font-medium">Μαθητής #{{ i + 1 }}</div>
                <button
                    pButton
                    icon="pi pi-times"
                    class="p-button-text"
                    (click)="removeStudent(i)"
                    [disabled]="studentsFA.length === 1">
                </button>
            </div>

            <div class="grid">
                <div class="col-12 md:col-3">
                    <label>Όνομα</label>
                    <input 
                        pInputText
                        [formControl]="s.controls.first_name"
                        class="w-full"
                        placeholder="Προσθήκη ονόματος μαθητή"
                    />
                </div>

                <div class="col-12 md:col-3">
                    <label>Επώνυμο</label>
                    <input 
                        pInputText
                        [formControl]="s.controls.last_name"
                        class="w-full"
                        placeholder="Προσθήκη επωνύμου μαθητή"
                        />
                </div>

                <div class="col-12 md:col-6">
                    <label>Ημ/νία γέννησης</label>
                    <p-datepicker
                        [formControl]="s.controls.birthdate"
                        [showIcon]="true"
                        [iconDisplay]="'input'"
                        class="w-full"
                        placeholder="Ημ/νία γέννησης μαθητή">
                    </p-datepicker>
                </div>

                <div class="col-12 md:col-6">
                    <label>Email</label>
                    <input 
                        pInputText
                        type="email"
                        [formControl]="s.controls.email"
                        class="w-full"
                        placeholder="Προσθήκη ηλεκτρονικής διεύθυνσης μαθητή"
                    />
                </div>

                <div class="col-12 md:col-6">
                    <label>Τηλέφωνο</label>
                    <input
                        pInputText
                        [formControl]="s.controls.phone"
                        class="w-full"
                        placeholder="Προσθήκη τηλεφώνου μαθητή"    
                    />
                </div>

                <div class="col-12 md:col-4">
                    <label>Οδός</label>
                    <input 
                        pInputText
                        [formControl]="s.controls.address.controls.street"
                        class="w-full"
                        placeholder="Προσθήκη οδό διαμονής μαθητή"
                    />
                </div>

                <div class="col-12 md:col-4">
                    <label>Πόλη</label>
                    <input 
                        pInputText
                        [formControl]="s.controls.address.controls.city"
                        class="w-full"
                        placeholder="Προσθήκη πόλης διαμονής μαθητή"    
                    />
                </div>

                <div class="col-12 md:col-4">
                    <label>Τ.Κ.</label>
                    <input
                        pInputText
                        [formControl]="s.controls.address.controls.zip"
                        class="w-full"
                        placeholder="Προσθήκη ταχυδρομικού κώδικα μαθητή"    
                    />
                </div>

                <div class="col-12 md:col-6">
                    <label>Επίπεδο</label>
                    <p-select 
                        [options]="levels"
                        optionLabel="label"
                        optionValue="value"
                        [formControl]="s.controls.level"
                        class="w-full">
                    </p-select>
                </div>

                <div class="col-12 md:col-6">
                    <label>Ενδιαφέροντα</label>
                    <p-multiSelect
                        [options]="interests"
                        optionLabel="label"
                        optionValue="value"
                        [formControl]="s.controls.interests"
                        display="chip"
                        class="w-full">
                    </p-multiSelect>
                </div>

                <div class="col-12 md:col-6">
                    <label>Σημειώσεις</label>
                    <textarea
                        pInputTextarea
                        [autoResize]="true"
                        rows="3"
                        [formControl]="s.controls.notes"
                        class="w-full"
                        placeholder="Παρατηρήσεις / πρόοδος">
                    </textarea>
                </div>

                <div class="col-12 md:col-6">
                    <label>Ιατρικές σημειώσεις</label>
                    <textarea
                        pInputTextarea
                        [autoResize]="true"
                        rows="3"
                        [formControl]="s.controls.medical_note"
                        class="w-full"
                        placeholder="Αλλεργίες, φαρμακευτική αγωγή κ.λπ.">
                    </textarea>
                </div>

                <div class="col-12">
                    <p-checkbox
                        [binary]="true"
                        [formControl]="s.controls.consent_media"
                        inputId="consent_media_{{ i }}">
                    </p-checkbox>
                    <label for="consent_media_{{ i }}" class="ml-2">
                        Συναινώ στη χρήση φωτογραφιών ή έργων του/της μαθητή/μαθήτριας
                        για προωθητικούς σκοπούς (π.χ. μέσα κοινωνικής δικτύωσης).
                    </label>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-3 flex justify-content-end gap-2">
        <a 
            pButton
            label="Άκυρο"
            class="p-button-text"
            routerLink="/students">
        </a>
        <button
            pButton
            label="Αποθήκευση"
            icon="pi pi-check"
            (click)="save()">
        </button>
    </div>
</p-card>
